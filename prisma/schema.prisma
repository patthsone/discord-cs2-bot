// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Guild {
  id        String   @id @db.VarChar(255)
  locale    String   @default("en") @db.VarChar(10)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(3)

  // Relations
  monitoredServers MonitoredServer[]
  userLevels       UserLevel[]
  levelRewards     LevelReward[]
  greetingSettings GreetingSetting?

  @@map("guilds")
}

model MonitoredServer {
  id            Int      @id @default(autoincrement())
  guildId       String   @map("guild_id") @db.VarChar(255)
  serverIp      String   @map("server_ip") @db.VarChar(255)
  serverPort    Int      @map("server_port")
  customName    String?  @map("custom_name") @db.VarChar(255)
  channelId     String   @map("channel_id") @db.VarChar(255)
  messageId     String?  @map("message_id") @db.VarChar(255)
  isActive      Boolean  @default(true) @map("is_active")
  checkInterval Int      @default(10) @map("check_interval")
  lastStatus    Boolean  @default(false) @map("last_status")
  lastPlayers   Int      @default(0) @map("last_players")
  lastMap       String?  @map("last_map") @db.VarChar(255)
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamp(3)

  // Relations
  guild   Guild           @relation(fields: [guildId], references: [id], onDelete: Cascade)
  history ServerHistory[]

  @@map("monitored_servers")
}

model ServerHistory {
  id         Int      @id @default(autoincrement())
  serverId   Int      @map("server_id")
  online     Boolean  @default(false)
  playersOnline Int   @default(0) @map("players_online")
  mapName    String?  @map("map_name") @db.VarChar(255)
  ping       Int?
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamp(3)

  // Relations
  server MonitoredServer @relation(fields: [serverId], references: [id], onDelete: Cascade)

  @@map("server_history")
}

model UserLevel {
  id              Int      @id @default(autoincrement())
  guildId         String   @map("guild_id") @db.VarChar(255)
  userId          String   @map("user_id") @db.VarChar(255)
  xp              BigInt   @default(0)
  level           Int      @default(0)
  messagesCount   Int      @default(0) @map("messages_count")
  voiceMinutes    Int      @default(0) @map("voice_minutes")
  lastMessage     DateTime? @map("last_message") @db.Timestamp(3)
  lastVoiceUpdate DateTime? @map("last_voice_update") @db.Timestamp(3)

  // Relations
  guild Guild @relation(fields: [guildId], references: [id], onDelete: Cascade)

  @@unique([guildId, userId], name: "unique_user_guild")
  @@map("user_levels")
}

model LevelReward {
  id      Int    @id @default(autoincrement())
  guildId String @map("guild_id") @db.VarChar(255)
  level   Int
  roleId  String @map("role_id") @db.VarChar(255)

  // Relations
  guild Guild @relation(fields: [guildId], references: [id], onDelete: Cascade)

  @@map("level_rewards")
}

model GreetingSetting {
  id              Int      @id @default(autoincrement())
  guildId         String   @map("guild_id") @db.VarChar(255)
  welcomeChannelId String? @map("welcome_channel_id") @db.VarChar(255)
  welcomeMessage  String?  @map("welcome_message") @db.Text
  autoRoleId      String?  @map("auto_role_id") @db.VarChar(255)
  isActive        Boolean  @default(true) @map("is_active")

  // Relations
  guild Guild @relation(fields: [guildId], references: [id], onDelete: Cascade)

  @@map("greeting_settings")
}

model UserLanguage {
  userId    String   @id @map("user_id") @db.VarChar(255)
  locale    String   @default("en") @db.VarChar(10)
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamp(3)

  @@map("user_languages")
}

model LogEntry {
  id        Int      @id @default(autoincrement())
  level     String   @db.VarChar(20)
  message   String   @db.Text
  metadata  String?  @db.Text
  timestamp DateTime @default(now()) @db.Timestamp(3)

  @@map("log_entries")
}
